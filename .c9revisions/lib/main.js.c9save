{"ts":1355510206082,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n\t | Version 10.1.1\n     | Copyright 2012 Esri\n     |\n     | Licensed under the Apache License, Version 2.0 (the \"License\");\n     | you may not use this file except in compliance with the License.\n     | You may obtain a copy of the License at\n     |\n     |    http://www.apache.org/licenses/LICENSE-2.0\n     |\n     | Unless required by applicable law or agreed to in writing, software\n     | distributed under the License is distributed on an \"AS IS\" BASIS,\n     | WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n     | See the License for the specific language governing permissions and\n     | limitations under the License.\n*/\n\ndojo.require(\"dijit.layout.BorderContainer\");\ndojo.require(\"dijit.layout.ContentPane\");\ndojo.require(\"esri.arcgis.utils\");\ndojo.require(\"esri.map\");\n\n/******************************************************\n***************** begin config section ****************\n*******************************************************/\n\nvar TITLE = \"Santa's Dashboard\"\nvar BYLINE = \"Discover and browse recent YouTube videos and Flickr photos on holiday themes.  Tap on the dashboard to switch themes; zoom in to discover more.\"\nvar SATELLITE_URL = \"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer\"\nvar BOUNDARIES_URL = \"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer\";\n\nvar COLOR_RED = \"#FF0000\";\nvar COLOR_ORANGE = \"#FF7D40\";\nvar COLOR_GREEN = \"#9CCB19\";\nvar COLOR_BLUE = \"#0000FF\";\n\n/******************************************************\n************************** init ***********************\n*******************************************************/\n\nvar _map;\nvar _locationsService;\nvar _selected;\n\nvar _layerSantas;\nvar _layerLights;\nvar _layerTree;\nvar _layerHolidays;\n\nvar _dojoReady = false;\nvar _jqueryReady = false;\n\nvar _initExtent;\n\nvar _lutColors = {}; \t// look-up tables\nvar _lutLayers = {};\n\nvar _isMobile = isMobile();\n\ndojo.addOnLoad(function() {_dojoReady = true;init()});\njQuery(document).ready(function() {_jqueryReady = true;init()});\n\n\nfunction init() {\n\n\tif (!_jqueryReady) return;\n\tif (!_dojoReady) return;\n\n\t$(this).resize(handleWindowResize);\n\n\t$(\"#title\").append(TITLE);\n\t$(\"#subtitle\").append(BYLINE);\n\n\t// correlate each check box to a result type.\n\n\t$($($.grep($(\".controlGroup\"),function(n,i){return $(n).find(\".controlCaption\").html() == \"Santa Claus\"})).find(\".check\")).attr(\"value\",PointAtts.RESULT_TYPE_SANTA);\n\t$($($.grep($(\".controlGroup\"),function(n,i){return $(n).find(\".controlCaption\").html() == \"Christmas lights\"})).find(\".check\")).attr(\"value\",PointAtts.RESULT_TYPE_LIGHTS);\n\t$($($.grep($(\".controlGroup\"),function(n,i){return $(n).find(\".controlCaption\").html() == \"Christmas tree\"})).find(\".check\")).attr(\"value\",PointAtts.RESULT_TYPE_TREE);\n\t$($($.grep($(\".controlGroup\"),function(n,i){return $(n).find(\".controlCaption\").html() == \"Holidays\"})).find(\".check\")).attr(\"value\",PointAtts.RESULT_TYPE_HOLIDAYS);\n\n\t// turn on \"Santa Claus\" check box by default.\n\n\t$($($.grep($(\".controlGroup\"),function(n,i){return $(n).find(\".controlCaption\").html() == \"Santa Claus\"})).find(\".check\")).attr(\"checked\",true);\n\n\t// initialize LocationsService\n\n\t_locationsService = new LocationsService();\n\t$(_locationsService).bind(\"complete\", processQueryResults);\n\n\t// create map & add layers\n\n\t_initExtent = new esri.geometry.Extent({\"xmin\":-16407360,\"ymin\":-748663,\"xmax\":-4197004,\"ymax\":10365891,\"spatialReference\":{\"wkid\":102100}});\n\n\t_map = new esri.Map(\"map\",{slider:false,wrapAround180:false,extent:_initExtent});\n\t_map.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(SATELLITE_URL));\n\t_map.addLayer(new esri.layers.ArcGISTiledMapServiceLayer(BOUNDARIES_URL));\n\n\t_layerSanta = new esri.layers.GraphicsLayer();\n\t_layerTree = new esri.layers.GraphicsLayer();\n\t_layerLights = new esri.layers.GraphicsLayer();\n\t_layerHolidays = new esri.layers.GraphicsLayer();\n\n\t_map.addLayer(_layerHolidays);\n\t_map.addLayer(_layerTree);\n\t_map.addLayer(_layerLights);\n\t_map.addLayer(_layerSanta);\n\n\t_layerSanta.show();\n\t_layerTree.hide();\n\t_layerLights.hide();\n\t_layerHolidays.hide();\n\n\t// layers look-up table\n\n \t_lutLayers[PointAtts.RESULT_TYPE_SANTA] = _layerSanta;\n \t_lutLayers[PointAtts.RESULT_TYPE_LIGHTS] = _layerLights;\n \t_lutLayers[PointAtts.RESULT_TYPE_TREE] = _layerTree;\n \t_lutLayers[PointAtts.RESULT_TYPE_HOLIDAYS] = _layerHolidays;\n\n\t// color look-up table\n\n \t_lutColors[PointAtts.RESULT_TYPE_SANTA] = COLOR_RED;\n \t_lutColors[PointAtts.RESULT_TYPE_LIGHTS] = COLOR_ORANGE;\n \t_lutColors[PointAtts.RESULT_TYPE_TREE] = COLOR_GREEN;\n \t_lutColors[PointAtts.RESULT_TYPE_HOLIDAYS] = COLOR_BLUE;\n\n\t// kick off part 2\n\n\tif (_map.loaded) init2();\n\telse dojo.connect(_map, 'onLoad', init2);\n\n}\n\nfunction init2() {\n\n\t$(\"#zoomIn\").click(function(e) {\n        _map.setLevel(_map.getLevel()+1);\n    });\n\t$(\"#zoomOut\").click(function(e) {\n        _map.setLevel(_map.getLevel()-1);\n    });\n\t$(\"#zoomExtent\").click(function(e) {\n        _map.setExtent(_initExtent);\n    });\n\n\t$(\".check\").click(function(e){\n\t\tvar layer = _lutLayers[$(e.target).attr(\"value\")];\n\t\tlayer.setVisibility(!$(e.target).attr(\"checked\"));\n\t});\n\n\t$(\".controlCaption\").click(function(e){\n\t\tvar check = $(e.target).parent().find(\"input\");\n\t\tif ($(check).attr(\"checked\")) $(check).attr(\"checked\",false);\n\t\telse $(check).attr(\"checked\",true);\n\t\tvar layer = _lutLayers[$(check).attr(\"value\")];\n\t\tlayer.setVisibility($(check).attr(\"checked\"));\n\t});\n\n\t$.each([_layerSanta,_layerTree,_layerLights,_layerHolidays],function(index,value) {\n\t\tdojo.connect(value, \"onMouseOver\", layer_onMouseOver);\n\t\tdojo.connect(value, \"onMouseOut\", layer_onMouseOut);\n\t\tdojo.connect(value, \"onClick\", layer_onClick);\n\t});\n\n\tdoQuery();\n\thandleWindowResize();\n\n    $(\".selectButton\").click(function(){\n        if($(this).attr(\"id\") === \"santa\"){\n            if($(this).hasClass(\"on\")){\n                $(this).attr(\"src\",\"images/buttons/SantaOff.png\");\n                $(this).addClass(\"off\");\n                $(this).removeClass(\"on\");\n            }\n            else{\n                $(this).attr(\"src\",\"images/buttons/SantaOn.png\");\n                $(this).addClass(\"on\");\n                $(this).removeClass(\"off\");\n            }\n            $(\".check\").eq(0).trigger(\"click\");\n        }\n        else if($(this).attr(\"id\") === \"lights\"){\n            if($(this).hasClass(\"on\")){\n                $(this).attr(\"src\",\"images/buttons/LightsOff.png\");\n                $(this).addClass(\"off\");\n                $(this).removeClass(\"on\");\n            }\n            else{\n                $(this).attr(\"src\",\"images/buttons/LightsOn.png\");\n                $(this).addClass(\"on\");\n                $(this).removeClass(\"off\");\n            }\n            $(\".check\").eq(1).trigger(\"click\");\n        }\n        else if($(this).attr(\"id\") === \"tree\"){\n            if($(this).hasClass(\"on\")){\n                $(this).attr(\"src\",\"images/buttons/TreeOff.png\");\n                $(this).addClass(\"off\");\n                $(this).removeClass(\"on\");\n            }\n            else{\n                $(this).attr(\"src\",\"images/buttons/TreeOn.png\");\n                $(this).addClass(\"on\");\n                $(this).removeClass(\"off\");\n            }\n            $(\".check\").eq(2).trigger(\"click\");\n        }\n        else{\n            if($(this).hasClass(\"on\")){\n                $(this).attr(\"src\",\"images/buttons/HolidaysOff.png\");\n                $(this).addClass(\"off\");\n                $(this).removeClass(\"on\");\n            }\n            else{\n                $(this).attr(\"src\",\"images/buttons/HolidaysOn.png\");\n                $(this).addClass(\"on\");\n                $(this).removeClass(\"off\");\n            }\n            $(\".check\").eq(3).trigger(\"click\");\n        }\n    });\n\n}\n\n/******************************************************\n****************** event handlers *********************\n*******************************************************/\n\nfunction handleWindowResize() {\n\tvar heightDoc = getViewportDimensions()[1];\n\t$(\"#mainWindow\").height(heightDoc - $(\"#header\").height());\n\tdijit.byId(\"mainWindow\").layout();\n\t$(\"#map\").height($(\"#mainWindow\").height() - $(\"#controlBar\").height());\n\tif (_map) _map.resize();\n\n    if($(window).width() < 1200){\n        $(\"#woodPane\").css(\"margin-left\",($(window).width() - 1000)/2);\n        $(\"#woodPane\").attr(\"src\",\"images/DashboardSmall.png\");\n    }\n    else if($(window).width() < 1600){\n        $(\"#woodPane\").css(\"margin-left\",($(window).width() - 1200)/2);\n        $(\"#woodPane\").attr(\"src\",\"images/DashboardWider.png\");\n    }\n    else{\n        $(\"#woodPane\").css(\"margin-left\",($(window).width() - 1600)/2);\n        $(\"#woodPane\").attr(\"src\",\"images/DashboardWidest.png\");\n    }\n}\n\nfunction layer_onClick(event)\n{\n\t$(\"#hoverInfo\").hide();\n\t_selected = event.graphic;\n\tpostSelection();\n}\n\nfunction layer_onMouseOver(event)\n{\n\tif (_isMobile) return;\n\t_map.setMapCursor(\"pointer\");\n\tvar graphic = event.graphic;\n\t$(\"#hoverInfo\").html(graphic.attributes.getTitle());\n\tvar pt = _map.toScreen(graphic.geometry);\n\thoverInfoPos(pt.x,pt.y);\n}\n\nfunction layer_onMouseOut(event)\n{\n\t_map.setMapCursor(\"default\");\n\t$(\"#hoverInfo\").hide();\n}\n\nfunction processQueryResults(event,locations){\n\tloadLocations(locations);\n\t$(\"#queryInProgress\").fadeOut();\n\t_selected = _layerSanta.graphics[0];\n\tpostSelection();\n}\n\n/******************************************************\n*************** private functions *********************\n*******************************************************/\n\nfunction doQuery() {\n\t$(\"#queryInProgress\").fadeIn();\n\tvar query = [\n\t\tPointAtts.RESULT_TYPE_SANTA,\n\t\tPointAtts.RESULT_TYPE_LIGHTS,\n\t\tPointAtts.RESULT_TYPE_TREE,\n\t\tPointAtts.RESULT_TYPE_HOLIDAYS\n\t];\n\t_locationsService.executeQuery(query);\n}\n\nfunction loadLocations(locations) {\n\t$.each(locations,function(index,value) {\n\t\tvalue.setSymbol(new esri.symbol.SimpleMarkerSymbol().setColor(_lutColors[value.attributes.getType()]));\n\t\t_lutLayers[value.attributes.getType()].add(value);\n\t});\n}\n\nfunction postSelection() {\n\t$(\"#media\").attr(\"src\",_selected.attributes.getURL());\n    \n    $(\"#media\").load(function(){\n        $(\"#media\").css({\n            \"margin-left\":(($(\"#pictureFrame\").width() - $(\"#media\").width())/2),\n            \"margin-top\":(($(\"#pictureFrame\").height() - $(\"#media\").height())/2)\n        });\n    });\n    $(\"#media\").css({\n        \"margin-left\":(($(\"#pictureFrame\").width() - $(\"#media\").width())/2),\n        \"margin-top\":(($(\"#pictureFrame\").height() - $(\"#media\").height())/2)\n    });\n}\n\n\nfunction hoverInfoPos(x,y){\n\tif (x <= ($(\"#map\").width())-230){\n\t\t$(\"#hoverInfo\").css(\"left\",x+15);\n\t}\n\telse{\n\t\t$(\"#hoverInfo\").css(\"left\",x-25-($(\"#hoverInfo\").width()));\n\t}\n\tif (y >= ($(\"#hoverInfo\").height())+50){\n\t\t$(\"#hoverInfo\").css(\"top\",y-35-($(\"#hoverInfo\").height()));\n\t}\n\telse{\n\t\t$(\"#hoverInfo\").css(\"top\",y-15+($(\"#hoverInfo\").height()));\n\t}\n\t$(\"#hoverInfo\").show();\n}"]],"start1":0,"start2":0,"length1":0,"length2":10871}]],"length":10871}
{"ts":1355510208621,"patch":[[{"diffs":[[0,"    $(\"#media\")."],[1,"d"],[0,"at"],[-1,"tr"],[1,"a"],[0,"(\"src\",_selected"]],"start1":10053,"start2":10053,"length1":36,"length2":36}]],"length":10925,"saved":false}
{"ts":1355510214749,"patch":[[{"diffs":[[0,").data(\""],[-1,"src"],[1,"at"],[0,"\",_selec"]],"start1":10067,"start2":10067,"length1":19,"length2":18}]],"length":10924,"saved":false}
{"ts":1355510215784,"patch":[[{"diffs":[[0,"data(\"at"],[1,"tr"],[0,"\",_selec"]],"start1":10069,"start2":10069,"length1":16,"length2":18}]],"length":10926,"saved":false}
{"ts":1355510219871,"patch":[[{"diffs":[[0,".attributes."],[-1,"getURL()"],[0,");\n    $(\"#m"]],"start1":10090,"start2":10090,"length1":32,"length2":24}]],"length":10918,"saved":false}
{"ts":1355510221103,"patch":[[{"diffs":[[0,"tributes"],[-1,"."],[0,");\n    $"]],"start1":10093,"start2":10093,"length1":17,"length2":16}]],"length":10917,"saved":false}
{"ts":1355510965966,"patch":[[{"diffs":[[0,"URL());\n    "],[1,"//"],[0,"$(\"#media\")."]],"start1":10045,"start2":10045,"length1":24,"length2":26}]],"length":10919,"saved":false}
{"ts":1355510969439,"patch":[[{"diffs":[[0,"butes);\n"],[1,"    $()\n"],[0,"    $(\"#"]],"start1":10098,"start2":10098,"length1":16,"length2":24}]],"length":10927,"saved":false}
{"ts":1355510970669,"patch":[[{"diffs":[[0,";\n    $("],[1,"\"\""],[0,")\n    $("]],"start1":10104,"start2":10104,"length1":16,"length2":18}]],"length":10929,"saved":false}
{"ts":1355510975376,"patch":[[{"diffs":[[0,"\n    $(\""],[1,"#l"],[0,"\")\n    $"]],"start1":10105,"start2":10105,"length1":16,"length2":18}]],"length":10931,"saved":false}
{"ts":1355510976611,"patch":[[{"diffs":[[0,"   $(\"#l"],[1,"igh"],[0,"\")\n    $"]],"start1":10107,"start2":10107,"length1":16,"length2":19}]],"length":10934,"saved":false}
{"ts":1355510978858,"patch":[[{"diffs":[[0,"$(\"#ligh"],[1,"tB"],[0,"\")\n    $"]],"start1":10110,"start2":10110,"length1":16,"length2":18}]],"length":10936,"saved":false}
{"ts":1355510979892,"patch":[[{"diffs":[[0,"\"#lightB"],[1,"o"],[0,"\")\n    $"]],"start1":10112,"start2":10112,"length1":16,"length2":17}]],"length":10937,"saved":false}
{"ts":1355510987678,"patch":[[{"diffs":[[0,"(\"#light"],[-1,"Bo"],[1,"boxLink"],[0,"\")\n    $"]],"start1":10111,"start2":10111,"length1":18,"length2":23}]],"length":10942,"saved":false}
{"ts":1355510989722,"patch":[[{"diffs":[[0,"oxLink\")"],[1,"."],[0,"\n    $(\""]],"start1":10120,"start2":10120,"length1":16,"length2":17}]],"length":10943,"saved":false}
{"ts":1355510991766,"patch":[[{"diffs":[[0,"xLink\")."],[1,"attr()"],[0,"\n    $(\""]],"start1":10121,"start2":10121,"length1":16,"length2":22}]],"length":10949,"saved":false}
{"ts":1355510993613,"patch":[[{"diffs":[[0,"\").attr("],[1,"\"\""],[0,")\n    $("]],"start1":10126,"start2":10126,"length1":16,"length2":18}]],"length":10951,"saved":false}
{"ts":1355510994638,"patch":[[{"diffs":[[0,").attr(\""],[1,"a"],[0,"\")\n    $"]],"start1":10127,"start2":10127,"length1":16,"length2":17}]],"length":10952,"saved":false}
{"ts":1355510995661,"patch":[[{"diffs":[[0,").attr(\""],[-1,"a"],[0,"\")\n    $"]],"start1":10127,"start2":10127,"length1":17,"length2":16}]],"length":10951,"saved":false}
{"ts":1355510997702,"patch":[[{"diffs":[[0,").attr(\""],[1,"hre"],[0,"\")\n    $"]],"start1":10127,"start2":10127,"length1":16,"length2":19}]],"length":10954,"saved":false}
{"ts":1355510998943,"patch":[[{"diffs":[[0,"ttr(\"hre"],[1,"f"],[0,"\")\n    $"]],"start1":10130,"start2":10130,"length1":16,"length2":17}]],"length":10955,"saved":false}
{"ts":1355511002633,"patch":[[{"diffs":[[0,"r(\"href\""],[1,","],[0,")\n    $("]],"start1":10132,"start2":10132,"length1":16,"length2":17}]],"length":10956,"saved":false}
{"ts":1355511008977,"patch":[[{"diffs":[[0,"(\"href\","],[1,"_selected.attributes.getURL()"],[0,")\n    $("]],"start1":10133,"start2":10133,"length1":16,"length2":45}]],"length":10985,"saved":false}
{"ts":1355511012661,"patch":[[{"diffs":[[0,"etURL())"],[1,".a"],[0,"\n    $(\""]],"start1":10163,"start2":10163,"length1":16,"length2":18}]],"length":10987,"saved":false}
{"ts":1355511013881,"patch":[[{"diffs":[[0,"URL()).a"],[1,"ttr()"],[0,"\n    $(\""]],"start1":10165,"start2":10165,"length1":16,"length2":21}]],"length":10992,"saved":false}
{"ts":1355511015317,"patch":[[{"diffs":[[0,")).attr("],[1,"\"\""],[0,")\n    $("]],"start1":10169,"start2":10169,"length1":16,"length2":18}]],"length":10994,"saved":false}
{"ts":1355511016142,"patch":[[{"diffs":[[0,").attr(\""],[1,"titl"],[0,"\")\n    $"]],"start1":10170,"start2":10170,"length1":16,"length2":20}]],"length":10998,"saved":false}
{"ts":1355511017165,"patch":[[{"diffs":[[0,"tr(\"titl"],[1,"e"],[0,"\")\n    $"]],"start1":10174,"start2":10174,"length1":16,"length2":17}]],"length":10999,"saved":false}
{"ts":1355511019414,"patch":[[{"diffs":[[0,"(\"title\""],[1,",\"\""],[0,")\n    $("]],"start1":10176,"start2":10176,"length1":16,"length2":19}]],"length":11002,"saved":false}
{"ts":1355511020246,"patch":[[{"diffs":[[0,"le\","],[-1,"\"\""],[0,")\n  "]],"start1":10181,"start2":10181,"length1":10,"length2":8}]],"length":11000,"saved":false}
{"ts":1355511140243,"patch":[[{"diffs":[[0,"\"title\","],[-1,")"],[1,"_selected.attributes.getTitle());"],[0,"\n    $(\""]],"start1":10177,"start2":10177,"length1":17,"length2":49}]],"length":11032,"saved":false}
